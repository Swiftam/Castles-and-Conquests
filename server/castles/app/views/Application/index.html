#{extends 'main.html' /}
#{set title:'Home' /}

#{set 'moreScripts'}
    #{script 'castles.js'/}
    #{script 'user.js'/}
    #{script 'land.js'/}
    #{script 'quests.js'/}
    #{script 'kontagent_api.js'/}
#{/set}

<div id="contentWindow">
    <div id="hud"></div>
    <ul id="menu">
        <li><a href="#lands" id="menuLand">Land</a></li>
        <li><a href="#quests" id="menuQuests">Quests</a></li>
        <li><a href="#profile" id="menuProfile">Profile</a></li>
    </ul>
    <div id="content"></div>
</div>

<script type="text/template" id="tpl-quest-list-item">
    <section class="quest" data-role="collapsible">
        <h2 class="quest-name">
            <a href="#quests/<%= id %>"><%= name %></a>
        </h2>

        <p><%= description %></p>
    </section>
</script>

<script type="text/template" id="tpl-hud">
    <span id="healthBar"><%= health %>/<%= healthMax %></span>
    <span id="levelBar">Level <%= level %></span>
    <span id="goldBar">Gold: <%= gold %></span>
    <span id="incomeBar">Income: <%= income %></span>
    <span id="networthBar">Net Worth: <%= netWorth %></span>
</script>

<script type="text/template" id="tpl-quest-details">
    <h1>&{'Mission.info.title'}</h1>

    <h2><%= name %></h2>

    <p>XP: <%= xp %></p>
    <p>Gold: <%= minGold %> - <%= maxGold %></p>

    <menu>
        <ul>
            <li><button class="run">&{'Mission.info.runButtonText'}</button></li>
            <li><a href="#quests" class="button">&{'Mission.info.backButtonText'}</a></li>
        </ul>
    </menu>
</script>

<script type="text/template" id="tpl-land-list-item">
    <section class="land" data-role="collapsible">
        <h2 class="land-name">
            <a href="#lands/<%- id %>"><%= name %></a>
            <span class="ui-li-count ui-btn-up-c ui-btn-corner-all">Owned: <%= quantity %></span>
        </h2>

        <p><%= description %></p>

        <p>Cost: <%= price %></p>

        <p>Income: <%= income %></p>

        <p><button onclick="location.href='#lands/<%= id%>'">&{'Application.land.moreinfo'}</button></p>
    </section>
</script>

<script type="text/template" id="tpl-land-details">
    <h1>&{'Property.info.title'}</h1>

    <h2><%= name %></h2>

    <p>Cost: <%= price %></p>

    <menu>
        <ul>
            <li><button class="buy">&{'Property.info.buyButtonText'}</button></li>
            <li><a href="#lands" class="button">&{'Property.info.backButtonText'}</a></li>
        </ul>
    </menu>
</script>

<script type="text/template" id="tpl-profile">
    <h1>User Profile</h1>

    <h2><%= name %></h2>

    <table>
        <tr>
            <td>Level</td>
            <td><%= level %></td>
        </tr>
        <tr>
            <td>Health</td>
            <td><%= health %>/<%= healthMax%></td>
        </tr>

        <tr>
            <td>XP:</td>
            <td><%= xp %>/<%= xpGoal%></td>
        </tr>

        <tr>
            <td>Net Worth:</td>
            <td><%= netWorth %></td>
        </tr>
    </table>
</script>

<script type="text/javascript">
    (function($) {
        $(document).ready(function() {
            // configure and instantiate Kontagent object
            var ktApiKey = "d50ed84282034078854af95946018865";
            var ktApi = new KontagentApi(ktApiKey, {
                useTestServer: true
            });

            ktApi.trackPageRequest("${user.id}");

            window.app = CastlesApp.init({
                kontagent: ktApi
            });
        });
    })(jQuery);
</script>